<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://www.gstatic.com/firebasejs/9.19.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.19.0/firebase-app.js"> </script>
    <script src="https://www.gstatic.com/firebasejs/9.19.0/firebase-database-compat.js"> </script>
    <script src="https://www.gstatic.com/firebasejs/9.19.0/firebase-auth.js"></script>
    <!-- <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-functions.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/9.19.0/firebase-messaging.js"></script>
</head>

<body>
    <label>Name</label><br />
    <input id="advname" placeholder="enter your Name"><br /><br />
    <label>Email</label><br />
    <input id="advemail" placeholder="enter your email"><br /><br />
    <label>Password</label><br />
    <input id="advpassword" placeholder="enter your Passwords"><br /><br />
    <select id="course">
        <option value="course 1">course 1</option>
        <option value="course 2">course 2</option>
        <option value="course 3">course 3</option>
        <option value="course 4">course 4</option>
    </select><br /><br />
    <label>number</label><br />
    <input id="number"><br /><br />
    <button onclick="signup()">register</button>


    <script>

        const firebaseApp = firebase.initializeApp({
            apiKey: "AIzaSyAFdtO7NYgHb4DbWXfirZpJpA8UDrMfbKs",
            authDomain: "advanced-course-data-base.firebaseapp.com",
            projectId: "advanced-course-data-base",
            storageBucket: "advanced-course-data-base.appspot.com",
            messagingSenderId: "327666396191",
            appId: "1:327666396191:web:aec68df5a22197d72af92a"
        });

        const auth = firebaseApp.auth();

        function signup() {
            const name = document.getElementById('advname').value;
            const email = document.getElementById('advemail').value;
            const password = document.getElementById('advpassword').value;
            const course = document.getElementById('course').value;
            const number = document.getElementById('number').value;
            var firebaseRef = firebase.database().ref(`${course}`)
            var coursevalue = {
                name: name,
                email: email,
                password: password,
                number: number,
                course: course
            }

            console.log(email, password);
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then(function () {
                    // Signed in 
                    console.log(course);
                    firebaseRef.push(coursevalue)
                    alert("you signed up");
                    // Initialize Messaging
                    var messaging = firebase.messaging();

                    // Request permission to send notifications
                    messaging.requestPermission().then(function () {
                        console.log('Notification permission granted.');

                        // Get the token for the current device
                        messaging.getToken().then(function (token) {
                            console.log('FCM token:', token);

                            // Send an SMS message
                            var smsMessage = {
                                to: `+91 ${number}`, // recipient's phone number
                                body: 'Hello, this is a test message!'
                            };
                            // Send the SMS message using FCM
                            fetch('https://fcm.googleapis.com/fcm/send', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': 'key=YOUR_SERVER_KEY'
                                },
                                body: JSON.stringify({
                                    to: token,
                                    data: {
                                        message: JSON.stringify(smsMessage),
                                        type: 'sms'
                                    }
                                })
                            }).then(function (response) {
                                console.log('SMS message sent successfully.');
                            }).catch(function (error) {
                                console.error('Error sending SMS message:', error);
                            });
                        }).catch(function (error) {
                            console.error('Error getting FCM token:', error);
                        });
                    }).catch(function (error) {
                        console.error('Error requesting notification permission:', error);
                    });

                    // document.getElementById("reg_form").reset()
                    // console.log(result);
                    // ...
                })
                .catch((error) => {
                    console.log(error.code);
                    console.log(error.message);
                    // ..
                });
        }


    </script>
</body>

</html>